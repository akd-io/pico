# Picotron findings

## Stat

- `stat(307) & 0x1` seems to be `1` for "trusted system apps"

## Docs

- Many builtins not documented in the official manual.
  - `_VERSION`, `kernal_path`, `kpath`, `cocreate`, `collectgarbage`, `costatus`, `error`, `getmetatable`, `ipairs`, `next`, `norm`, `pack`, `pcall`, `pid`, `rawequal`, `rawget`, `rawlen`, `rawset`, `select`, `setmetatable`, `sgn`, `stat`, `tokenoid`, `tonum`, `tonumber`, `tostring`, `unpack`, `warn`, `yield`, `USERDATA`, `_G`, `coroutine`, `debug`, `math`, `string`, `table`, `utf8`
- Correct interface for `window()` is `window(width,height,attribs)`
- `window()` supports `x` and `y` to set position, and `dx` and `dy` to move the window by an offset.

## Misc

- `_update` runs at 60 fps. `_update60` is not a thing in Picotron.
- @soundsdotzip on Discord mentioned `store("screenshot.png",get_display())` to save a screenshot.
- @_maxine_ mentioned `store("/desktop/trash.loc", {location="/ram/compost"})`
- No `//` comments

## Dumps

### Builtins - `_ENV`

See [`builtins.txt`](drive/dumps/builtins.txt) for full list of all builtins. Generated by [`builtins.lua`](drive/desktop/projects/builtins/main.lua) as part of [`dump.lua`](drive/projects/dump/dump.lua).

### Environment - `env()`

See [`env.txt`](drive/dumps/env.txt) for sample object returned by `env()`. Generated by [`env.lua`](drive/desktop/projects/env/main.lua) as part of [`dump.lua`](drive/projects/dump/dump.lua).

### Ram - `/ram`

See [`/ram`](drive/dumps/ram) folder for a dump of all files in Picotron's `/ram` folder. Generated by [`dump.lua`](drive/projects/dump/dump.lua).

### System - `/system`

See [`/system`](drive/dumps/system) folder for a dump of all files in Picotron's `/system` folder. Generated by [`dump.lua`](drive/projects/dump/dump.lua).

## Feedback

### (Reported) `print()` or `_update()` doesn't run in `.lua` file run from terminal

The following script runs well when hitting `CTRL+R` in the editor.

But it shows no logs in the Picotron terminal, or host terminal, when run from the Picotron terminal.

```lua
function _update()
  print("update")
  printh("update")
end
```

### (Reported) Present working directory

Contrary to expectation, `pwd()` points to script location, while `env().path` points to the directory from which the script was run.

However, `/system/util/pwd.lua` interprets present working directory to mean the directory from which the script was run, and uses `env().path` to determine it.

`/ram/system/processes.pod` also interprets present working directory to mean the directory from which the script was run, and uses the value equivalent to `env().path` for the `pwd` property.

### (Reported) `mkdir()`

Current behavior:

- On success, mkdir() returns nil.
- On failure, mkdir() returns "mkdir failed".

Expected behavior:

On failure, mkdir() throws an error?

Or mkdir() returns `success, error`, where `success` is a boolean and `error` is an error message.

I've only tried mkdir() failing when trying to create a directory in a directory that doesn't exist. A specific error message for that scenario would be great.

A possible fix could also be to make mkdir() recursive by default.
